<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Notepad</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="editor-header">
                <h2>My Notes</h2>
                <button class="btn" id="newNoteBtn">➕ New</button>
            </div>

            <input type="text" id="searchInput" placeholder="Search notes..." class="search-bar">
            <div class="notes-list" id="notesList"></div>

            <div class="backup-controls">
                <button class="btn btn-secondary" id="exportNotesBtn">📤 Export</button>
                <button class="btn btn-secondary" id="importNotesBtn">📥 Import</button>
                <input type="file" id="importNotesInput" style="display:none;">
            </div>
        </aside>

        <main class="main-content">
            <div class="editor-header">
                <input type="text" id="noteTitle" placeholder="Note Title">
                <span class="save-status" id="saveStatus">All changes saved</span>
                <div class="action-buttons">
                    <button class="btn btn-save" id="saveNoteBtn">💾 Save & New</button>
                    <button class="icon-btn" id="downloadNoteBtn" title="Download Note">⬇️</button>
                    <button class="icon-btn" id="deleteNoteBtn" title="Delete Note">🗑️ Delete</button>
                </div>
            </div>
            <span id="lastModified">Last edited: Never</span>
            <textarea id="notepad" placeholder="Start writing..."></textarea>
            <div class="note-stats">
                <span id="wordCount">Words: 0</span> | 
                <span id="charCount">Characters: 0</span>
            </div>
        </main>
    </div>

    <button class="theme-switch" id="themeSwitch">🌙</button>

    <script>
        const notepad = document.getElementById('notepad');
        const noteTitle = document.getElementById('noteTitle');
        const notesList = document.getElementById('notesList');
        const newNoteBtn = document.getElementById('newNoteBtn');
        const deleteNoteBtn = document.getElementById('deleteNoteBtn');
        const saveStatus = document.getElementById('saveStatus');
        const themeSwitch = document.getElementById('themeSwitch');
        const searchInput = document.getElementById('searchInput');
        const wordCount = document.getElementById('wordCount');
        const charCount = document.getElementById('charCount');
        const lastModified = document.getElementById('lastModified');
        const downloadNoteBtn = document.getElementById('downloadNoteBtn');
        const saveNoteBtn = document.getElementById('saveNoteBtn');
        const exportNotesBtn = document.getElementById('exportNotesBtn');
        const importNotesBtn = document.getElementById('importNotesBtn');
        const importNotesInput = document.getElementById('importNotesInput');

        let currentNoteId = null;
        let saveTimeout = null;

        function loadNotes(filter = '') {
            const notes = JSON.parse(localStorage.getItem('notes')) || [];
            notesList.innerHTML = '';
            const filtered = notes.filter(note =>
                note.title.toLowerCase().includes(filter.toLowerCase()) ||
                note.content.toLowerCase().includes(filter.toLowerCase())
            );

            filtered.forEach((note, index) => {
                const noteElement = document.createElement('div');
                noteElement.className = 'note-item';
                noteElement.setAttribute('data-id', note.id);
                noteElement.style.animationDelay = `${index * 0.05}s`;
                noteElement.innerHTML = `
                    <div class="note-content">
                        <strong>${note.title || 'Untitled Note'}</strong>
                        <div>${new Date(note.lastModified).toLocaleDateString()} ${new Date(note.lastModified).toLocaleTimeString()}</div>
                    </div>`;
                noteElement.addEventListener('click', () => loadNote(note.id));
                notesList.appendChild(noteElement);
            });

            if (!currentNoteId && notes.length > 0) loadNote(notes[0].id);
        }

        function createNewNote() {
            // Add smooth transition animation
            const mainContent = document.querySelector('.main-content');
            mainContent.style.opacity = '0.7';
            mainContent.style.transform = 'translateY(10px)';
            
            setTimeout(() => {
                const note = {
                    id: Date.now(),
                    title: 'Untitled Note',
                    content: '',
                    lastModified: new Date()
                };
                const notes = JSON.parse(localStorage.getItem('notes')) || [];
                notes.unshift(note);
                localStorage.setItem('notes', JSON.stringify(notes));
                
                // Clear current note fields
                noteTitle.value = 'Untitled Note';
                notepad.value = '';
                currentNoteId = null;
                
                // Load the new note
                loadNotes();
                loadNote(note.id);
                
                // Focus on title and select text for easy editing
                noteTitle.focus();
                noteTitle.select();
                
                // Restore main content with animation
                mainContent.style.opacity = '1';
                mainContent.style.transform = 'translateY(0)';
                
                // Update stats
                updateStats();
            }, 150);
        }

        function loadNote(id) {
            const notes = JSON.parse(localStorage.getItem('notes')) || [];
            const note = notes.find(n => n.id === id);
            if (note) {
                // Add loading animation to main content
                const mainContent = document.querySelector('.main-content');
                mainContent.style.opacity = '0.7';
                mainContent.style.transform = 'translateY(10px)';
                
                setTimeout(() => {
                    currentNoteId = id;
                    noteTitle.value = note.title;
                    notepad.value = note.content;
                    lastModified.textContent = `Last edited: ${new Date(note.lastModified).toLocaleTimeString()}`;
                    document.querySelectorAll('.note-item').forEach(i => i.classList.remove('active'));
                    const el = document.querySelector(`.note-item[data-id="${id}"]`);
                    if (el) el.classList.add('active');
                    updateStats();
                    
                    // Restore main content
                    mainContent.style.opacity = '1';
                    mainContent.style.transform = 'translateY(0)';
                }, 150);
            }
        }

        function autoSave() {
            if (!currentNoteId) return;
            
            // Update save status with animation
            saveStatus.textContent = 'Saving...';
            saveStatus.className = 'save-status saving';
            
            if (saveTimeout) clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                const notes = JSON.parse(localStorage.getItem('notes')) || [];
                const idx = notes.findIndex(n => n.id === currentNoteId);
                if (idx !== -1) {
                    notes[idx] = {
                        ...notes[idx],
                        title: noteTitle.value || 'Untitled Note',
                        content: notepad.value,
                        lastModified: new Date()
                    };
                    localStorage.setItem('notes', JSON.stringify(notes));
                    
                    // Success animation
                    saveStatus.textContent = '✓ Saved';
                    saveStatus.className = 'save-status';
                    
                    // Reset to default after 2 seconds
                    setTimeout(() => {
                        saveStatus.textContent = 'All changes saved';
                    }, 2000);
                    
                    lastModified.textContent = `Last edited: ${new Date().toLocaleTimeString()}`;
                    loadNotes(searchInput.value);
                }
            }, 800);
        }

        function saveAndNewNote() {
            // Save current note if it exists and has content
            if (currentNoteId && (noteTitle.value.trim() || notepad.value.trim())) {
                // Force save the current note
                const notes = JSON.parse(localStorage.getItem('notes')) || [];
                const idx = notes.findIndex(n => n.id === currentNoteId);
                if (idx !== -1) {
                    notes[idx] = {
                        ...notes[idx],
                        title: noteTitle.value || 'Untitled Note',
                        content: notepad.value,
                        lastModified: new Date()
                    };
                    localStorage.setItem('notes', JSON.stringify(notes));
                }
            }
            
            // Create new note
            createNewNote();
            
            // Show success feedback
            saveStatus.textContent = '✓ Saved & new note created!';
            saveStatus.className = 'save-status';
            setTimeout(() => {
                saveStatus.textContent = 'All changes saved';
            }, 2000);
        }

        function deleteNote() {
            if (!currentNoteId) return;
            
            // Add confirmation with smooth animation
            if (!confirm('Are you sure you want to delete this note?')) return;
            
            // Animate deletion
            const noteElement = document.querySelector(`.note-item[data-id="${currentNoteId}"]`);
            if (noteElement) {
                noteElement.style.transform = 'scale(0.8)';
                noteElement.style.opacity = '0';
                setTimeout(() => {
                    const notes = JSON.parse(localStorage.getItem('notes')) || [];
                    const updated = notes.filter(n => n.id !== currentNoteId);
                    localStorage.setItem('notes', JSON.stringify(updated));
                    currentNoteId = null;
                    noteTitle.value = '';
                    notepad.value = '';
                    loadNotes();
                }, 300);
            }
        }

        function updateStats() {
            const text = notepad.value.trim();
            const words = text.split(/\s+/).filter(Boolean).length;
            wordCount.textContent = `Words: ${words}`;
            charCount.textContent = `Characters: ${text.length}`;
        }

        // Theme
        function initializeTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.body.classList.toggle('dark-mode', theme === 'dark');
            themeSwitch.textContent = theme === 'dark' ? '☀️' : '🌙';
        }

        themeSwitch.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            themeSwitch.textContent = isDark ? '☀️' : '🌙';
        });

        // Download note
        downloadNoteBtn.addEventListener('click', () => {
            if (!currentNoteId) return alert('No note selected!');
            const title = noteTitle.value || 'Untitled Note';
            const blob = new Blob([notepad.value], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${title}.txt`;
            a.click();
        });

        // Export / Import
        exportNotesBtn.addEventListener('click', () => {
            const notes = localStorage.getItem('notes');
            if (!notes || notes === '[]') {
                alert('No notes to export!');
                return;
            }
            
            // Add loading state
            exportNotesBtn.textContent = '📤 Exporting...';
            exportNotesBtn.disabled = true;
            
            setTimeout(() => {
                const blob = new Blob([notes], { type: 'application/json' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `my_notes_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                // Reset button
                exportNotesBtn.textContent = '📤 Export';
                exportNotesBtn.disabled = false;
                
                // Show success feedback
                saveStatus.textContent = '✓ Notes exported!';
                saveStatus.className = 'save-status';
                setTimeout(() => {
                    saveStatus.textContent = 'All changes saved';
                }, 2000);
            }, 500);
        });

        importNotesBtn.addEventListener('click', () => importNotesInput.click());
        importNotesInput.addEventListener('change', e => {
            const file = e.target.files[0];
            if (!file) return;
            
            // Add loading state
            importNotesBtn.textContent = '📥 Importing...';
            importNotesBtn.disabled = true;
            
            const reader = new FileReader();
            reader.onload = evt => {
                try {
                    const importedData = JSON.parse(evt.target.result);
                    if (Array.isArray(importedData)) {
                        localStorage.setItem('notes', evt.target.result);
                        loadNotes();
                        
                        // Success feedback
                        saveStatus.textContent = `✓ ${importedData.length} notes imported!`;
                        saveStatus.className = 'save-status';
                        setTimeout(() => {
                            saveStatus.textContent = 'All changes saved';
                        }, 3000);
                    } else {
                        throw new Error('Invalid file format');
                    }
                } catch (error) {
                    alert('Error importing notes. Please make sure the file is a valid notes backup.');
                    saveStatus.textContent = '✗ Import failed';
                    saveStatus.className = 'save-status error';
                    setTimeout(() => {
                        saveStatus.textContent = 'All changes saved';
                        saveStatus.className = 'save-status';
                    }, 3000);
                }
                
                // Reset button
                importNotesBtn.textContent = '📥 Import';
                importNotesBtn.disabled = false;
                e.target.value = ''; // Reset file input
            };
            reader.readAsText(file);
        });

        // Listeners
        notepad.addEventListener('input', () => { autoSave(); updateStats(); });
        noteTitle.addEventListener('input', autoSave);
        newNoteBtn.addEventListener('click', createNewNote);
        saveNoteBtn.addEventListener('click', saveAndNewNote);
        deleteNoteBtn.addEventListener('click', deleteNote);
        searchInput.addEventListener('input', e => loadNotes(e.target.value));

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + N for new note
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                createNewNote();
            }
            
            // Ctrl/Cmd + Shift + S for save and new note
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                saveAndNewNote();
            }
            
            // Ctrl/Cmd + S for save (prevent default browser save)
            if ((e.ctrlKey || e.metaKey) && e.key === 's' && !e.shiftKey) {
                e.preventDefault();
                autoSave();
            }
            
            // Ctrl/Cmd + E for export
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                exportNotesBtn.click();
            }
            
            // Delete key for deleting note
            if (e.key === 'Delete' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                deleteNote();
            }
        });

        // Add smooth scroll behavior
        document.documentElement.style.scrollBehavior = 'smooth';

        // Initialize app with fade-in animation
        document.body.style.opacity = '0';
        document.body.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            document.body.style.transition = 'all 0.6s ease';
            document.body.style.opacity = '1';
            document.body.style.transform = 'translateY(0)';
        }, 100);

        initializeTheme();
        loadNotes();
    </script>
</body>
</html>